#!/usr/bin/env bash
source "/toolbox64.env" &&
  source "${TOOLBOX64_LIB}/bashlib64.bash" || exit 1

#
# Variables
#

declare process='Install Helm 3'
declare package_installer='linux-amd64'
declare package_installer_bin="${package_installer}/helm"
declare package_source='helm-v3.11.0-linux-amd64.tar.gz'
declare package_url='https://get.helm.sh'
declare app_mode='0755'
declare app_root='/opt/helm'
declare app_bin="${app_root}/bin"
declare app_cli="${app_bin}/helm"
declare -i status=1

#
# Main
#

bl64_os_match 'OL' || exit $?

bl64_msg_all_enable_verbose
bl64_msg_show_batch_start "$process"

package_installer="${TOOLBOX64_TMP}/${package_installer}"
package_installer_bin="${TOOLBOX64_TMP}/${package_installer_bin}"
bl64_rxtx_web_get_file "${package_url}/${package_source}" "${TOOLBOX64_TMP}/${package_source}" #&&
  bl64_arc_open_tar "${TOOLBOX64_TMP}/${package_source}" "${TOOLBOX64_TMP}" &&
  bl64_check_command "$package_installer_bin"
status=$?

if ((status == 0)); then
  bl64_fs_create_dir "$app_mode" "$BL64_LIB_DEFAULT" "$BL64_LIB_DEFAULT" "$app_root" "$app_bin" &&
    bl64_fs_copy_files "$app_mode" "$BL64_LIB_DEFAULT" "$BL64_LIB_DEFAULT" "$app_bin" "$package_installer_bin" &&
    bl64_check_command "$app_cli" &&
    bl64_msg_show_info "Application files installed under: ${app_root}"
    bl64_msg_show_info "Application binaty file: ${app_cli}"
  status=$?
fi

bl64_msg_show_task "clean temporary files"
[[ -d package_installer ]] && bl64_fs_rm_full "$package_installer"

bl64_msg_show_batch_finish "$status" "$process"
exit $status
