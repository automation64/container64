#!/usr/bin/env bash

# shellcheck disable=SC1091
source "/toolbox64.env" || exit $?
# shellcheck source=SCRIPTDIR/../../loader/bashlib64.bash disable=SC2154
source "$TOOLBOX64_BASHLIB64" || exit $?

#
# Functions
#

tb64_pg13_provision() {

  local source='postgresql:13'
  local packages='postgresql'

  bl64_msg_show_task "Enable package repository (${source})"
  bl64_pkg_run_dnf --assumeyes module enable "$source" ||
    return $?

  bl64_msg_show_task 'deploy application'
  # shellcheck disable=SC2086
  bl64_pkg_deploy $packages

}

#
# Main
#

declare process='Install PostgreSQL 13 CLI'
declare -i tb64_pg13_status=0

[[ -n "$TOOLBOX64_DEBUG" ]] && bl64_dbg_lib_enable
bl64_os_match "${BL64_OS_OL}-8" || {
  bl64_check_alert_unsupported
  exit $?
}
bl64_check_privilege_root &&
  bl64_pkg_setup ||
  exit $?

bl64_msg_all_enable_verbose
bl64_msg_show_batch_start "$process"

tb64_pg13_provision
tb64_pg13_status=$?

bl64_msg_show_batch_finish "$tb64_pg13_status" "$process"
exit $tb64_pg13_status
